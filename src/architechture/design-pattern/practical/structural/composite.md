---
title: Composite Pattern Practice
tags:
  - design-pattern
categories: 
date created: 2024-03-28
date modified: 2024-03-28
---

# Composite Pattern Practice: Ph√¢n lo·∫°i kh√°n gi·∫£ kh√°c nhau ƒë·ªÉ ph√°t phi·∫øu qu√† t·∫∑ng, x√¢y d·ª±ng decision tree

## Gi·ªõi thi·ªáu

A-->|text|B

**Nh·ªè m·ªõi ph·∫£i l·ª±a ch·ªçn, l·ªõn th√¨ ch·ªçn t·∫•t**

V√†i nƒÉm tr∆∞·ªõc, m·ªói khi tr√™n c√°c di·ªÖn ƒë√†n, ai ƒë√≥ n√™n h·ªçc ng√¥n ng·ªØ l·∫≠p tr√¨nh n√†o, ng√¥n ng·ªØ n√†o t·ªët nh·∫•t. C√°c thread n√†y lu√¥n s√¥i n·ªïi, c√≥ ng∆∞·ªùi ·ªßng h·ªô PHP, c√≥ ng∆∞·ªùi th√≠ch Java, c≈©ng c√≥ C++ v√† C#. Nh∆∞ng trong v√†i nƒÉm g·∫ßn ƒë√¢y, d∆∞·ªùng nh∆∞ m·ªçi ng∆∞·ªùi kh√¥ng th·ª±c s·ª± tranh lu·∫≠n "ch√©m gi√≥" n·ªØa, h·∫ßu h·∫øt th·ªùi gian ƒë·ªÅu l√† ƒë√πa c·ª£t. Trong khi ƒë√≥, trong ph√°t tri·ªÉn Internet n√≥i chung, nhi·ªÅu khi l√† m·ªôt s·ªë ng√¥n ng·ªØ l·∫≠p tr√¨nh ƒë∆∞·ª£c s·ª≠ d·ª•ng chung, c√πng x√¢y d·ª±ng m·ªôt h·ªá sinh th√°i to√†n di·ªán. C√°ch m√† m·ªçi ng∆∞·ªùi ch·ªçn c≈©ng nghi√™ng v·ªÅ vi·ªác ch·ªçn ki·∫øn tr√∫c ph√π h·ª£p cho t·ª´ng lƒ©nh v·ª±c, thay v√¨ m√π qu√°ng theo ƒëu·ªïi m·ªôt ng√¥n ng·ªØ n√†o ƒë√≥. ƒêi·ªÅu n√†y c√≥ th·ªÉ ƒë∆∞a ra m·ªôt s·ªë g·ª£i √Ω cho nh·ªØng ng∆∞·ªùi m·ªõi h·ªçc l·∫≠p tr√¨nh, kh√¥ng n√™n t·ª± √°i r·∫±ng m·ªôt ng√¥n ng·ªØ n√†o ƒë√≥ t·ªët h∆°n, m·ªôt ng√¥n ng·ªØ n√†o ƒë√≥ kh√¥ng t·ªët h∆°n, ch·ªâ c·∫ßn ch·ªçn ng√¥n ng·ªØ ph√π h·ª£p v·ªõi t·ª´ng t√¨nh hu·ªëng. V√† b·∫°n c√≥ th·ªÉ quy·∫øt ƒë·ªãnh ng√¥n ng·ªØ n√†o ƒë·ªÉ h·ªçc d·ª±a tr√™n nhu c·∫ßu tuy·ªÉn d·ª•ng v√† m·ª©c l∆∞∆°ng tr√™n c√°c trang web tuy·ªÉn d·ª•ng.

**L·∫≠p tr√¨nh kh√¥ng ph·∫£i l√† vi·ªác th·ªÉ hi·ªán k·ªπ nƒÉng**

Lu√¥n c√≥ m·ªôt s·ªë ng∆∞·ªùi th√≠ch s·ª≠ d·ª•ng m·ªôt s·ªë t√≠nh nƒÉng m·ªõi trong d·ª± √°n ph√°t tri·ªÉn t·ªïng th·ªÉ, th·ª≠ nghi·ªám ki·∫øn th·ª©c m·ªõi c·ªßa h·ªç. Kh√¥ng th·ªÉ n√≥i r·∫±ng ƒëi·ªÅu n√†y l√† kh√¥ng t·ªët, th·∫≠m ch√≠ c√≥ th·ªÉ n√≥i ƒë√¢y l√† m·ªôt ph·∫ßn c·ªßa nh·ªØng ng∆∞·ªùi r·∫•t ƒëam m√™ h·ªçc h·ªèi, th√≠ch s√°ng t·∫°o, th√≠ch th·ª±c h√†nh. Nh∆∞ng ngo√†i vi·ªác s·ª≠ d·ª•ng c√°c t√≠nh nƒÉng m·ªõi, vi·ªác c√¢n nh·∫Øc v·ªÅ m·∫∑t to√†n b·ªô s·ª± m·ªü r·ªông, d·ªÖ ƒë·ªçc, t√≠nh b·∫£o tr√¨, d·ªÖ m·ªü r·ªông v√† c√°c kh√≠a c·∫°nh kh√°c c≈©ng c·∫ßn ƒë∆∞·ª£c xem x√©t. Gi·ªëng nh∆∞ vi·ªác b·∫°n thu√™ m·ªôt nh√≥m th·ª£ trang tr√≠, c√≥ m·ªôt c√¥ng nh√¢n th·ª£ nh·ªè th√≠ch th·ª±c hi·ªán c√°c ho·∫°t ƒë·ªông trang tr√≠ ngh·ªá thu·∫≠t, l·∫Øp ƒë·∫∑t m·ªôt chi·∫øc b·ªìn c·∫ßu üöø d∆∞·ªõi v√≤i sen üöΩ trong nh√† c·ªßa b·∫°n.

**Ngay c·∫£ khi vi·∫øt CRUD c≈©ng n√™n c√≥ m·∫´u thi·∫øt k·∫ø**

Th∆∞·ªùng th√¨ nhu c·∫ßu l·ªõn nh·∫•t ƒë∆∞·ª£c x√¢y d·ª±ng th√¥ng qua vi·ªác th√™m, s·ª≠a, x√≥a v√† truy v·∫•n, h√¥m nay th√™m m·ªôt y√™u c·∫ßu `if`, ng√†y mai th√™m m·ªôt n·ªôi dung `else` ƒë·ªÉ m·ªü r·ªông. D·∫ßn d·∫ßn, nhu c·∫ßu ng√†y c√†ng l·ªõn, chi ph√≠ m·ªü r·ªông v√† b·∫£o tr√¨ c≈©ng tƒÉng l√™n. Th∆∞·ªùng th√¨ ƒëa s·ªë ph√°t tri·ªÉn kh√¥ng c√≥ t∆∞ duy s·∫£n ph·∫©m v√† kh√¥ng h∆∞·ªõng ƒë·∫øn nhu c·∫ßu kinh doanh t·ªïng th·ªÉ, lu√¥n nghƒ© r·∫±ng vi·∫øt code t·ªët l√† ho√†n th√†nh ch·ª©c nƒÉng. Nh∆∞ng vi·ªác tri·ªÉn khai kh√¥ng c√¢n nh·∫Øc v·ªÅ t√≠nh m·ªü r·ªông c·ªßa vi·ªác n√†y, r·∫•t kh√≥ ƒë·ªÉ l√†m cho c√°c y√™u c·∫ßu sau n√†y c√≥ th·ªÉ ƒë∆∞·ª£c ph√°t tri·ªÉn nhanh ch√≥ng, d·∫ßn d·∫ßn r∆°i v√†o v√≤ng l·∫∑p ti√™u c·ª±c, m·ªói ng√†y ƒë·ªÅu c√≥ bug c·∫ßn ph·∫£i s·ª≠a.

## M√¥i tr∆∞·ªùng ph√°t tri·ªÉn

1. JDK 1.8
2. Idea + Maven
3. Code: [vanhung4499/practical-java-design](https://github.com/vanhung4499/practical-java-design)  

| D·ª± √°n            | M√¥ t·∫£                                                                                 |
| ---------------- | ------------------------------------------------------------------------------------- |
| demo-design-8-01 | T Tri·ªÉn khai y√™u c·∫ßu nghi·ªáp v·ª• m·ªôt c√°ch tr·ª±c ti·∫øp                                     |
| demo-design-8-02 | T·ªëi ∆∞u h√≥a v√† t√°i c·∫•u tr√∫c code th√¥ng qua thi·∫øt k·∫ø m·∫´u, t·∫°o ra m·ªôt so s√°nh ƒë·ªÉ h·ªçc h·ªèi |

## Gi·ªõi thi·ªáu v·ªÅ Composite Pattern

![image.png](https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240328114627.png)

T·ª´ h√¨nh tr√™n, b·∫°n c√≥ th·ªÉ th·∫•y ƒë√¢y gi·ªëng nh∆∞ m·ªôt lo·∫°i ƒëinh v√≠t üî© v√† ·ªëc v√≠t, t·ªï ch·ª©c th√†nh m·ªôt c√¢y c·∫•u tr√∫c th√¥ng qua m·ªôt chu·ªói li√™n k·∫øt. V√† c√°ch thi·∫øt k·∫ø n√†y, b·∫±ng c√°ch t·ªï h·ª£p c√°c ƒë·ªëi t∆∞·ª£ng t∆∞∆°ng t·ª± (_c≈©ng c√≥ th·ªÉ g·ªçi l√† ph∆∞∆°ng th·ª©c_) th√†nh m·ªôt nh√≥m ƒë·ªëi t∆∞·ª£ng c√¢y c·∫•u tr√∫c c√≥ th·ªÉ ƒë∆∞·ª£c g·ªçi l√† Composite Pattern.

C√°ch thi·∫øt k·∫ø n√†y cho ph√©p b·∫°n t·ª± do k·∫øt h·ª£p c√°c n√∫t d·ªãch v·ª• c·ªßa m√¨nh ƒë·ªÉ cung c·∫•p d·ªãch v·ª• b√™n ngo√†i, v√≠ d·ª• b·∫°n c√≥ ba ch·ª©c nƒÉng ki·ªÉm tra nguy√™n t·ª≠ (`A: CMND`, `B: Th·∫ª ng√¢n h√†ng`, `C: S·ªë ƒëi·ªán tho·∫°i`) v√† cung c·∫•p cho b√™n ngo√†i. M·ªôt s·ªë b√™n g·ªçi c√≥ th·ªÉ s·ª≠ d·ª•ng k·∫øt h·ª£p AB, m·ªôt s·ªë c√≥ th·ªÉ s·ª≠ d·ª•ng k·∫øt h·ª£p CBA, v√† c√≥ th·ªÉ c√≥ m·ªôt s·ªë ch·ªâ s·ª≠ d·ª•ng m·ªôt trong ba. L√∫c n√†y, b·∫°n c√≥ th·ªÉ s·ª≠ d·ª•ng Composite Pattern ƒë·ªÉ x√¢y d·ª±ng d·ªãch v·ª•, c·∫•u tr√∫c c√¢y t·ªï ch·ª©c kh√°c nhau cho c√°c b√™n g·ªçi kh√°c nhau, v√† b·∫°n c√≥ th·ªÉ c·∫•u h√¨nh c√¢y n√†y v√†o c∆° s·ªü d·ªØ li·ªáu ho·∫∑c ƒëi·ªÅu khi·ªÉn n√≥ th√¥ng qua interface ƒë·ªì h·ªça.

V√¨ v·∫≠y, vi·ªác s·ª≠ d·ª•ng c√°c m·∫´u thi·∫øt k·∫ø kh√°c nhau trong c√°c t√¨nh hu·ªëng ph√π h·ª£p c√≥ th·ªÉ l√†m cho logic code r·∫•t r√µ r√†ng v√† d·ªÖ m·ªü r·ªông, ƒë·ªìng th·ªùi c≈©ng c√≥ th·ªÉ gi·∫£m thi·ªÉu chi ph√≠ h·ªçc c·ªßa nh√≥m ƒë·ªëi v·ªõi nh·ªØng ng∆∞·ªùi m·ªõi.

## M√¥ ph·ªèng k·ªãch b·∫£n

```mermaid
flowchart TD
MAge[Age]
FAge[Age]

Gender-->|Male|MAge
Gender-->|Female|FAge
MAge-->|<=25|A
MAge-->|>25|B
FAge-->|<=25|C
FAge-->|>25|D
```

Tr√™n ƒë√¢y l√† m·ªôt phi√™n b·∫£n r·∫•t ƒë∆°n gi·∫£n c·ªßa `decision tree (Decision Tree)` ti·∫øp th·ªã, d·ª±a tr√™n `gi·ªõi t√≠nh` v√† `tu·ªïi` ƒë·ªÉ ph√°t c√°c lo·∫°i phi·∫øu gi·∫£m gi√° kh√°c nhau, nh·∫±m k√≠ch th√≠ch ti√™u d√πng v√† t·∫°o ra m·ª•c ti√™u ch√≠nh x√°c ƒë·ªÉ k√≠ch ho·∫°t ng∆∞·ªùi d√πng.  

M·∫∑c d√π m·ªôt s·ªë b·∫°n c√≥ th·ªÉ ch∆∞a t·ª´ng ph√°t tri·ªÉn c√°c t√¨nh hu·ªëng ti·∫øp th·ªã, nh∆∞ng b·∫°n c√≥ th·ªÉ b·ªã ti·∫øp th·ªã b·∫•t c·ª© l√∫c n√†o. V√≠ d·ª•, n·∫øu b·∫°n th∆∞·ªùng xuy√™n duy·ªát c√°c s·∫£n ph·∫©m m√† nam gi·ªõi th√≠ch nh∆∞ b√†n ph√≠m c∆°, laptop, trang tr√≠ √¥ t√¥ v√† nhi·ªÅu h∆°n n·ªØa, b·∫°n s·∫Ω nh·∫≠n ƒë∆∞·ª£c c√°c phi·∫øu gi·∫£m gi√° t∆∞∆°ng t·ª± ƒë·ªÉ k√≠ch th√≠ch ti√™u d√πng. V√† n·∫øu b·∫°n kh√¥ng mua s·∫Øm nhi·ªÅu ho·∫∑c kh√¥ng c√≥ ti·ªÅn m·∫∑t trong tay, b·∫°n c√≥ bao gi·ªù b·ªã ƒë∆∞a gi√° xe? C√≥ m·ªôt th·ªùi gian, b·∫°n th∆∞·ªùng nghe ng∆∞·ªùi kh√°c k√™u g·ªçi, t·∫°i sao c√πng m·ªôt kho·∫£ng c√°ch, h·ªç l·∫°i 10 ƒë·ªìng, t√¥i l·∫°i 15 ƒë·ªìng? Th·ª±c t·∫ø l√† ƒë√¢y l√† c√°c tr∆∞·ªùng h·ª£p ƒë∆∞·ª£c ti·∫øp th·ªã, th∆∞·ªùng xuy√™n ti·∫øn h√†nh c√°c bi·ªán ph√°p k√≠ch th√≠ch m·∫°nh m·∫Ω h∆°n ƒë·ªëi v·ªõi nh·ªØng ng∆∞·ªùi d√πng √≠t s·ª≠ d·ª•ng ph·∫ßn m·ªÅm, nh·∫±m tƒÉng t√≠nh g·∫Øn k·∫øt c·ªßa ng∆∞·ªùi d√πng.

V·∫≠y n√™n, ·ªü ƒë√¢y ch√∫ng t√¥i s·∫Ω m√¥ ph·ªèng m·ªôt t√¨nh hu·ªëng t∆∞∆°ng t·ª±, th·ªÉ hi·ªán s·ª± quan tr·ªçng c·ªßa Composite Pattern trong ƒë√≥. Ngo√†i ra, Composite Pattern kh√¥ng ch·ªâ c√≥ th·ªÉ √°p d·ª•ng cho decision tree quy t·∫Øc, m√† c√≤n c√≥ th·ªÉ s·ª≠ d·ª•ng ƒë·ªÉ ƒë√≥ng g√≥i d·ªãch v·ª• b·∫±ng c√°ch k·∫øt h·ª£p c√°c interface kh√°c nhau, cung c·∫•p kh·∫£ nƒÉng d·ªãch v·ª• cho b√™n ngo√†i v√† gi·∫£m chi ph√≠ ph√°t tri·ªÉn.

## Tri·ªÉn khai code h√†ng lo·∫°t

·ªû ƒë√¢y ch√∫ng ta s·∫Ω tr√¨nh b√†y m·ªôt v√≠ d·ª• v·ªÅ vi·ªác "ph√°t sinh" c√¢u chuy·ªán v·ªÅ m·ªëi quan h·ªá gi·ªØa c√¥ g√°i v√† l·∫≠p tr√¨nh vi√™n üë®‚Äçüíª.

|        Ng√†y        | Y√™u c·∫ßu                                                                                                                                                                                                                                                    | M·ª©c ƒë·ªô kh·∫©n c·∫•p                       | L·∫≠p tr√¨nh vi√™n (ti·∫øng n√≥i b√™n ngo√†i)                       |                                         |
| :----------------: | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------------------------------------ | :--------------------------------------------------------- | --------------------------------------- |
| Th·ª© Hai, Bu·ªïi s√°ng | Anh l·∫≠p tr√¨nh vi√™n, s·∫øp n√≥i mu·ªën l√†m m·ªôt ch√∫t ti·∫øp th·ªã, g·ª≠i c√°c lo·∫°i phi·∫øu gi·∫£m gi√° kh√°c nhau cho nam v√† n·ªØ ƒë·ªÉ k√≠ch th√≠ch ti√™u d√πng.                                                                                                                       | R·∫•t c·∫•p b√°ch, cu·ªëi ng√†y mai ph·∫£i xong | ƒê∆∞·ª£c, c≈©ng kh√¥ng kh√≥ l·∫Øm, th√™m m·ªôt s·ªë ƒëi·ªÅu ki·ªán if l√† ƒë∆∞·ª£c |                                         |
| Th·ª© Ba, Bu·ªïi chi·ªÅu | Anh ch√†ng, sau khi ch√∫ng ta ƒë√£ tri·ªÉn khai, m·ªçi th·ª© ƒë·ªÅu t·ªët. H√£y th√™m ƒëi·ªÅu ki·ªán theo ƒë·ªô tu·ªïi, d·ªÖ d√†ng k√≠ch th√≠ch ti√™u d√πng ch√≠nh x√°c h∆°n d·ª±a tr√™n c√°c nh√≥m tu·ªïi.                                                                                            | C·∫•p b√°ch, ng√†y mai ph·∫£i xong          | C≈©ng kh√¥ng kh√≥, th√™m ƒëi·ªÅu ki·ªán th√¥i                        |                                         |
|  Th·ª© T∆∞, Bu·ªïi t·ªëi  | √îi, anh! Anh ƒë√£ ƒëi ng·ªß ch∆∞a? S·∫øp n√≥i r·∫±ng ho·∫°t ƒë·ªông c·ªßa ch√∫ng ta r·∫•t th√†nh c√¥ng, li·ªáu anh c√≥ th·ªÉ th√™m c√°c ƒëi·ªÅu ki·ªán cho ƒë·ªôc th√¢n, ƒë√£ k·∫øt h√¥n v√† c√≥ con. ƒêi·ªÅu n√†y s·∫Ω k√≠ch th√≠ch ng∆∞·ªùi d√πng mua s·∫Øm h∆°n.                                                     | R·∫•t c·∫•p b√°ch, h√£y tri·ªÉn khai ngay     | T√¥i nh·∫≠n ra r·∫±ng c√≥ qu√° nhi·ªÅu ƒëi·ªÅu ki·ªán if else r·ªìi        |                                         |
| Th·ª© NƒÉm, S√°ng s·ªõm  | Wow! Anh th·∫≠t tuy·ªát v·ªùi, tri·ªÉn khai r·∫•t nhanh ch√≥ng. Hehe! C√≥ m·ªôt y√™u c·∫ßu nh·ªè, c·∫ßn ƒëi·ªÅu ch·ªânh c√°c nh√≥m tu·ªïi, v√¨ hi·ªán nay sinh vi√™n b·∫Øt ƒë·∫ßu c√≥ b·∫°n g√°i s·ªõm h∆°n, nh·ªØng ng∆∞·ªùi ƒë√£ c√≥ b·∫°n g√°i d·ªÖ mua nh·∫•t ƒë·ªãnh s·∫£n ph·∫©m h∆°n. B·∫°n h√£y thay ƒë·ªïi gi√° tr·ªã m·ªôt ch√∫t! | S·∫øp ƒëang ƒë·ª£i ƒë·∫•y!                     | Ph·∫£i s·ª≠a ƒë·ªïi nhi·ªÅu gi√° tr·ªã, √¥i! C√≥ qu√° nhi·ªÅu if else r·ªìi   |                                         |
|  Th·ª© S√°u, N·ª≠a ƒë√™m  | Tr·ªùi ∆°i! Gi·ªù n√†y c√≤n th·ª©c √†! √îi, ƒë√£ h·ªèng r·ªìi, t·∫°i sao vi·ªác g·ª≠i phi·∫øu gi·∫£m gi√° kh√¥ng ch√≠nh x√°c, ƒë√£ c√≥ ph·∫£n √°nh t·ª´ kh√°ch h√†ng, nhi·ªÅu c√¥ g√°i ƒë√£ ƒë·∫øn ph·∫£n ƒë·ªëi. B·∫°n h√£y xem xem. √îi, s·∫øp ∆°i‚Ä¶                                                                    |                                       | (M·ªôt tr√°n ƒë·∫ßy m·ªì h√¥i), √îi, gi√° tr·ªã d√≠nh sai v·ªã tr√≠!        | Cu·ªëi c√πng, l·∫°i m·ªôt m√¨nh g√°nh h·∫øt t·∫•t c·∫£ |

### C·∫•u tr√∫c d·ª± √°n

```java
design-demo-8-01/
‚îú‚îÄ‚îÄ pom.xml
‚îî‚îÄ‚îÄ src
    ‚îî‚îÄ‚îÄ main
        ‚îî‚îÄ‚îÄ java
            ‚îî‚îÄ‚îÄ com
                ‚îî‚îÄ‚îÄ hnv99
                    ‚îî‚îÄ‚îÄ design
                        ‚îî‚îÄ‚îÄ EngineController.java
```

- N·∫øu trong c√¥ng ty c√≥ nh·ªØng l·∫≠p tr√¨nh vi√™n nh∆∞ v·∫≠y ch·∫Øc ch·∫Øn s·∫Ω ti·∫øt ki·ªám ƒë∆∞·ª£c r·∫•t nhi·ªÅu chi ph√≠, kh√¥ng c·∫ßn x√¢y d·ª±ng microservice g√¨ c·∫£, m·ªôt d·ª± √°n c√≥ th·ªÉ x·ª≠ l√Ω h·∫øt c√¥ng vi·ªác!

### Tri·ªÉn khai code

```java
  
public class EngineController {  
  
    private Logger logger = LoggerFactory.getLogger(EngineController.class);  
  
    public String process(final String userId, final String userSex, final int userAge) {  
  
        logger.info("S·ª≠ d·ª•ng c√°ch th·ª±c hi·ªán if-else ƒë·ªÉ x√°c ƒë·ªãnh k·∫øt qu·∫£ ng∆∞·ªùi d√πng. userIdÔºö{} userSexÔºö{} userAgeÔºö{}", userId, userSex, userAge);  
  
        if ("man".equals(userSex)) {  
            if (userAge < 25) {  
                return "K·∫øt qu·∫£ A";  
            }  
            if (userAge >= 25) {  
                return "K·∫øt qu·∫£ B";  
            }        }  
        if ("woman".equals(userSex)) {  
            if (userAge < 25) {  
                return "K·∫øt qu·∫£ C";  
            }  
            if (userAge >= 25) {  
                return "K·∫øt qu·∫£ D";  
            }        }  
        return null;  
  
    }  
}
```

- Ngo√†i vi·ªác m·ªü r·ªông v√† b·∫£o tr√¨ m·ªói l·∫ßn, c√°ch tri·ªÉn khai n√†y c≈©ng l√† nhanh nh·∫•t. V√† v·ªÅ h√¨nh th·ª©c, n√≥ c≈©ng r·∫•t d·ªÖ hi·ªÉu cho ng∆∞·ªùi m·ªõi.
- Nh∆∞ng `T√¥i khuy√™n b·∫°n kh√¥ng n√™n vi·∫øt nh∆∞ v·∫≠y`, vi·∫øt code nh∆∞ th·∫ø n√†y s·∫Ω b·ªã m·∫•t ƒëi·ªÉm ho·∫∑c b·ªã sa th·∫£i (senior s·∫Ω th∆∞·ªùng xuy√™n review code tr∆∞·ªõc khi th·ª±c hi·ªán merge request).

### Ki·ªÉm th·ª≠

#### Vi·∫øt l·ªõp ki·ªÉm tra

```java
public class ApiTest {  
  
    private Logger logger = LoggerFactory.getLogger(ApiTest.class);  
  
    @Test  
    public void testEngineController() {  
        EngineController engineController = new EngineController();  
        String process = engineController.process("Oli09pLkdjh", "man", 29);  
        logger.info("K·∫øt qu·∫£ ki·ªÉm th·ª≠: {}", process);  
    }  
}
```

- ·ªû ƒë√¢y ch√∫ng ta m√¥ ph·ªèng m·ªôt ID ng∆∞·ªùi d√πng, v√† truy·ªÅn gi·ªõi t√≠nh: `man`, v√† tu·ªïi: `29`, k·∫øt qu·∫£ d·ª± ki·∫øn c·ªßa ch√∫ng ta l√†: `K·∫øt qu·∫£ B`. Trong th·ª±c t·∫ø, ƒëi·ªÅu n√†y t∆∞∆°ng ƒë∆∞∆°ng v·ªõi vi·ªác `g·ª≠i m·ªôt phi·∫øu gi·∫£m gi√° l·ª±a ch·ªçn cho ng∆∞·ªùi d√πng`.

#### K·∫øt qu·∫£ ki·ªÉm tra

```shell
2024-03-28 14:12:46.816	INFO	main		(EngineController.java:12)	|	S·ª≠ d·ª•ng c√°ch th·ª±c hi·ªán if-else ƒë·ªÉ x√°c ƒë·ªãnh k·∫øt qu·∫£ ng∆∞·ªùi d√πng. userIdÔºöOli09pLkdjh userSexÔºöman userAgeÔºö29
2024-03-28 14:12:46.822	INFO	main		(ApiTest.java:15)	|	K·∫øt qu·∫£ ki·ªÉm th·ª≠: K·∫øt qu·∫£ B
```

- T·ª´ k·∫øt qu·∫£ ki·ªÉm tra, ch∆∞∆°ng tr√¨nh c·ªßa ch√∫ng ta ho·∫°t ƒë·ªông b√¨nh th∆∞·ªùng v√† kh·ªõp v·ªõi k·∫øt qu·∫£ d·ª± ki·∫øn, ch·ªâ c√≥ ƒëi·ªÅu c√°ch tri·ªÉn khai kh√¥ng ph·∫£i l√† m·ªôt ph∆∞∆°ng ph√°p ƒë∆∞·ª£c khuy·∫øn kh√≠ch. Ti·∫øp theo, ch√∫ng ta s·∫Ω s·ª≠ d·ª•ng `Composite Pattern` ƒë·ªÉ t·ªëi ∆∞u h√≥a ph·∫ßn code n√†y.

## T√°i c·∫•u tr√∫c theo Composite Pattern

**Trong ph·∫ßn n√†y, ch√∫ng ta s·∫Ω s·ª≠ d·ª•ng Composite Pattern ƒë·ªÉ t·ªëi ∆∞u code, ƒë√¢y c≈©ng l√† m·ªôt qu√° tr√¨nh t√°i c·∫•u tr√∫c nh·ªè.**

Vi·ªác t√°i c·∫•u tr√∫c n√†y c√≥ th·ªÉ g√¢y ra m·ªôt l∆∞·ª£ng thay ƒë·ªïi code l·ªõn h∆°n so v·ªõi tr∆∞·ªõc ƒë√≥, b·ªüi v√¨ ch√∫ng ta c·∫ßn t·ªï ch·ª©c c√°c n√∫t quy·∫øt ƒë·ªãnh kh√°c nhau v√† k·∫øt h·ª£p ch√∫ng th√†nh m·ªôt decision tree c√≥ th·ªÉ ch·∫°y ƒë∆∞·ª£c, c·∫ßn ph·∫£i th·ª±c hi·ªán thi·∫øt k·∫ø ƒëi·ªÅu ch·ªânh v√† g·ªçi c√°c ph∆∞∆°ng th·ª©c c·ªßa nh√† m√°y, ƒë·∫∑c bi·ªát l√† vi·ªác x√°c ƒë·ªãnh interface v√† abstract class, v√† kh·ªüi t·∫°o c·∫•u h√¨nh n√∫t quy·∫øt ƒë·ªãnh (gi·ªõi t√≠nh, tu·ªïi). T√¥i khuy√™n b·∫°n n√™n ƒë·ªçc k·ªπ m·ªôt v√†i l·∫ßn ph·∫ßn code n√†y v√† th·ª±c h√†nh nhi·ªÅu h∆°n.

> [!note] Tree  
> B·∫°n c·∫ßn ph·∫£i hi·ªÉu c·∫•u tr√∫c d·ªØ li·ªáu c√¢y ƒë·ªÉ c√≥ th·ªÉ ti·∫øp t·ª•c ƒë·ªçc.  
> Vi·ªác h·ªçc c·∫•u tr√∫c d·ªØ li·ªáu v√† gi·∫£i thu·∫≠t c≈©ng r·∫•t quan tr·ªçng. B·∫°n c√≥ th·ªÉ ƒë·ªçc th√™m ·ªü ƒë√¢y [[DSA MOC]].

### C·∫•u tr√∫c d·ª± √°n

```shell
design-demo-8-02
‚îú‚îÄ‚îÄ pom.xml
‚îî‚îÄ‚îÄ src
    ‚îú‚îÄ‚îÄ main
    ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ java
    ‚îÇ¬†¬†     ‚îî‚îÄ‚îÄ com
    ‚îÇ¬†¬†         ‚îî‚îÄ‚îÄ hnv99
    ‚îÇ¬†¬†             ‚îî‚îÄ‚îÄ design
    ‚îÇ¬†¬†                 ‚îî‚îÄ‚îÄ domain
    ‚îÇ¬†¬†                     ‚îú‚îÄ‚îÄ model
    ‚îÇ¬†¬†                     ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ aggregate
    ‚îÇ¬†¬†                     ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ TreeRich.java
    ‚îÇ¬†¬†                     ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ vo
    ‚îÇ¬†¬†                     ‚îÇ¬†¬†     ‚îú‚îÄ‚îÄ EngineResult.java
    ‚îÇ¬†¬†                     ‚îÇ¬†¬†     ‚îú‚îÄ‚îÄ TreeNode.java
    ‚îÇ¬†¬†                     ‚îÇ¬†¬†     ‚îú‚îÄ‚îÄ TreeNodeLink.java
    ‚îÇ¬†¬†                     ‚îÇ¬†¬†     ‚îî‚îÄ‚îÄ TreeRoot.java
    ‚îÇ¬†¬†                     ‚îî‚îÄ‚îÄ service
    ‚îÇ¬†¬†                         ‚îú‚îÄ‚îÄ engine
    ‚îÇ¬†¬†                         ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ EngineBase.java
    ‚îÇ¬†¬†                         ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ EngineConfig.java
    ‚îÇ¬†¬†                         ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ IEngine.java
    ‚îÇ¬†¬†                         ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ impl
    ‚îÇ¬†¬†                         ‚îÇ¬†¬†     ‚îî‚îÄ‚îÄ TreeEngineHandle.java
    ‚îÇ¬†¬†                         ‚îî‚îÄ‚îÄ logic
    ‚îÇ¬†¬†                             ‚îú‚îÄ‚îÄ BaseLogic.java
    ‚îÇ¬†¬†                             ‚îú‚îÄ‚îÄ LogicFilter.java
    ‚îÇ¬†¬†                             ‚îî‚îÄ‚îÄ impl
    ‚îÇ¬†¬†                                 ‚îú‚îÄ‚îÄ UserAgeFilter.java
    ‚îÇ¬†¬†                                 ‚îî‚îÄ‚îÄ UserGenderFilter.java
    ‚îî‚îÄ‚îÄ test
        ‚îî‚îÄ‚îÄ java
            ‚îî‚îÄ‚îÄ com
                ‚îî‚îÄ‚îÄ hnv99
                    ‚îî‚îÄ‚îÄ design
                        ‚îî‚îÄ‚îÄ ApiTest.java

```

**C·∫•u tr√∫c m√¥ h√¨nh c·ªßa Composite Pattern**

![demo-design-8-03.png](https://raw.githubusercontent.com/vanhung4499/images/master/snap/demo-design-8-03.png)

- ƒê·∫ßu ti√™n, b·∫°n c√≥ th·ªÉ nh√¨n v√†o c·∫•u tr√∫c c√¢y h∆∞·ªõng d·∫´n m√¥ ph·ªèng trong khung m√†u ƒëen: `1`, `11`, `12`, `111`, `112`, `121`, `122`, ƒë√¢y l√† m·ªôt nh√≥m ID n√∫t c√¢y ƒë∆∞·ª£c k·∫øt h·ª£p th√†nh m·ªôt c√¢y.
    
- Ti·∫øp theo l√† ph·∫ßn s∆° ƒë·ªì l·ªõp, ph√≠a b√™n tr√°i l√† t·ª´ `LogicFilter` b·∫Øt ƒë·∫ßu ƒë·ªãnh nghƒ©a b·ªô l·ªçc, `BaseLogic` l√† tri·ªÉn khai interface, cung c·∫•p c√°c ph∆∞∆°ng th·ª©c c∆° b·∫£n nh·∫•t. `UserAgeFilter`, `UserGenerFilter` l√† hai l·ªõp s·ª≠ d·ª•ng ƒë·ªÉ x√°c ƒë·ªãnh `tu·ªïi` v√† `gi·ªõi t√≠nh`.
    
- Cu·ªëi c√πng l√† t·ªï t·ªï ch·ª©c c√¥ng c·ª• th·ª±c thi decision tree. C≈©ng x√°c ƒë·ªãnh engine interface v√† c·∫•u h√¨nh c∆° b·∫£n, trong c·∫•u h√¨nh, c√°c n√∫t quy·∫øt ƒë·ªãnh m·∫´u c·∫ßn ƒë∆∞·ª£c thi·∫øt l·∫≠p.

```java
static {
     logicFilterMap = new ConcurrentHashMap<>();
     logicFilterMap.put("userAge", new UserAgeFilter());
     logicFilterMap.put("userGender", new UserGenderFilter());
}

```

- Ti·∫øp theo t√¥i s·∫Ω gi·∫£i th√≠ch chi ti·∫øt c√°c l·ªõp.

### Tri·ªÉn khai code

#### C√°c l·ªõp c∆° b·∫£n

| ƒê∆∞·ªùng d·∫´n g√≥i    | L·ªõp          | M√¥ t·∫£                                  |
| ---------------- | ------------ | -------------------------------------- |
| model.aggregates | TreeRich     | ƒê·ªëi t∆∞·ª£ng t·ªïng h·ª£p, ch·ª©a th√¥ng tin c√¢y |
| model.vo         | EngineResult | ƒê·ªëi t∆∞·ª£ng tr·∫£ v·ªÅ quy·∫øt ƒë·ªãnh            |
| model.vo         | TreeNode     | ƒê·ªëi t∆∞·ª£ng n√∫t c√¢y: n√∫t l√°, n√∫t qu·∫£     |
| model.vo         | TreeNodeLink | Li√™n k·∫øt n√∫t c√¢y                       |
| model.vo         | TreeRoot     | Th√¥ng tin g·ªëc c·ªßa c√¢y                  |

#### Interface b·ªô l·ªçc logic c·ªßa n√∫t c√¢y

```java
public interface LogicFilter {

    /**
     * B·ªô l·ªçc quy·∫øt ƒë·ªãnh logic
     *
     * @param matterValue          Gi√° tr·ªã quy·∫øt ƒë·ªãnh
     * @param treeNodeLineInfoList Danh s√°ch n√∫t decision tree
     * @return ID c·ªßa n√∫t ti·∫øp theo
     */
    Long filter(String matterValue, List<TreeNodeLink> treeNodeLineInfoList);

    /**
     * L·∫•y gi√° tr·ªã quy·∫øt ƒë·ªãnh
     *
     * @param treeId          ID c·ªßa c√¢y
     * @param userId          ID c·ªßa ng∆∞·ªùi d√πng
     * @param decisionMatter  Th√¥ng tin quy·∫øt ƒë·ªãnh
     * @return Gi√° tr·ªã quy·∫øt ƒë·ªãnh
     */
    String matterValue(Long treeId, String userId, Map<String, String> decisionMatter);

}
```

- Ph·∫ßn n√†y ƒë·ªãnh nghƒ©a interface chung cho vi·ªác t∆∞∆°ng th√≠ch, b·ªô l·ªçc logic v√† l·∫•y gi√° tr·ªã quy·∫øt ƒë·ªãnh, ƒë·∫£m b·∫£o m·ªói n√∫t cung c·∫•p kh·∫£ nƒÉng quy·∫øt ƒë·ªãnh ƒë·ªÅu ph·∫£i tri·ªÉn khai interface n√†y ƒë·ªÉ ƒë·∫£m b·∫£o t√≠nh nh·∫•t qu√°n.

#### L·ªõp tr·ª´u t∆∞·ª£ng BaseLogic cung c·∫•p quy·∫øt ƒë·ªãnh logic

```java
public abstract class BaseLogic implements LogicFilter {

    @Override
    public Long filter(String matterValue, List<TreeNodeLink> treeNodeLinkList) {
        for (TreeNodeLink nodeLine : treeNodeLinkList) {
            if (decisionLogic(matterValue, nodeLine)) return nodeLine.getNodeIdTo();
        }
        return 0L;
    }

    @Override
    public abstract String matterValue(Long treeId, String userId, Map<String, String> decisionMatter);

    private boolean decisionLogic(String matterValue, TreeNodeLink nodeLink) {
        switch (nodeLink.getRuleLimitType()) {
            case 1:
                return matterValue.equals(nodeLink.getRuleLimitValue());
            case 2:
                return Double.parseDouble(matterValue) > Double.parseDouble(nodeLink.getRuleLimitValue());
            case 3:
                return Double.parseDouble(matterValue) < Double.parseDouble(nodeLink.getRuleLimitValue());
            case 4:
                return Double.parseDouble(matterValue) <= Double.parseDouble(nodeLink.getRuleLimitValue());
            case 5:
                return Double.parseDouble(matterValue) >= Double.parseDouble(nodeLink.getRuleLimitValue());
            default:
                return false;
        }
    }

}
```

- Trong ph∆∞∆°ng th·ª©c tr·ª´u t∆∞·ª£ng, ta tri·ªÉn khai c√°c ph∆∞∆°ng th·ª©c interface v√† ƒë·ªìng th·ªùi ƒë·ªãnh nghƒ©a ph∆∞∆°ng th·ª©c quy·∫øt ƒë·ªãnh c∆° b·∫£n: `1, 2, 3, 4, 5`, logic so s√°nh `b·∫±ng, nh·ªè h∆°n, l·ªõn h∆°n, nh·ªè h∆°n ho·∫∑c b·∫±ng, l·ªõn h∆°n ho·∫∑c b·∫±ng`.
- ƒê·ªìng th·ªùi ƒë·ªãnh nghƒ©a ph∆∞∆°ng th·ª©c tr·ª´u t∆∞·ª£ng, m√† m·ªói l·ªõp tri·ªÉn khai interface ph·∫£i cung c·∫•p gi√° tr·ªã quy·∫øt ƒë·ªãnh theo quy t·∫Øc ƒë∆∞·ª£c ch·ªâ ƒë·ªãnh.

#### C√°c l·ªõp tri·ªÉn khai logic c·ªßa n√∫t c√¢y

**N√∫t tu·ªïi**

```java
public class UserAgeFilter extends BaseLogic {

    @Override
    public String matterValue(Long treeId, String userId, Map<String, String> decisionMatter) {
        return decisionMatter.get("age");
    }

}
```

**N√∫t gi·ªõi t√≠nh**

```java
public class UserGenderFilter extends BaseLogic {

    @Override
    public String matterValue(Long treeId, String userId, Map<String, String> decisionMatter) {
        return decisionMatter.get("gender");
    }

}
```

- C√°ch l·∫•y gi√° tr·ªã c·ªßa hai n√∫t quy·∫øt ƒë·ªãnh tr√™n r·∫•t ƒë∆°n gi·∫£n, ch·ªâ c·∫ßn l·∫•y ƒë·∫ßu v√†o c·ªßa ng∆∞·ªùi d√πng l√† ƒë·ªß. Trong th·ª±c t·∫ø, c√≥ th·ªÉ l·∫•y gi√° tr·ªã t·ª´ c∆° s·ªü d·ªØ li·ªáu, RPC, cache v√† nhi·ªÅu c√°ch kh√°c.

#### ƒê·ªãnh nghƒ©a decision engine interface

```java
public interface IEngine {

    EngineResult process(final Long treeId, final String userId, TreeRich treeRich, final Map<String, String> decisionMatter);

}
```

- ƒê·ªëi v·ªõi b√™n s·ª≠ d·ª•ng c≈©ng c·∫ßn ƒë·ªãnh nghƒ©a m·ªôt interface th·ªëng nh·∫•t ƒë·ªÉ thao t√°c, ƒëi·ªÅu n√†y r·∫•t ti·ªán l·ª£i cho vi·ªác m·ªü r·ªông ra c√°c lo·∫°i engine quy·∫øt ƒë·ªãnh kh√°c nhau, c√≥ th·ªÉ x√¢y d·ª±ng c√°c nh√† decision engine kh√°c nhau.

#### C·∫•u h√¨nh n√∫t quy·∫øt ƒë·ªãnh

```java
public class EngineConfig {

    static Map<String, LogicFilter> logicFilterMap;

    static {
        logicFilterMap = new ConcurrentHashMap<>();
        logicFilterMap.put("userAge", new UserAgeFilter());
        logicFilterMap.put("userGender", new UserGenderFilter());
    }

    public Map<String, LogicFilter> getLogicFilterMap() {
        return logicFilterMap;
    }

    public void setLogicFilterMap(Map<String, LogicFilter> logicFilterMap) {
        this.logicFilterMap = logicFilterMap;
    }

}
```

- ·ªû ƒë√¢y, c·∫•u h√¨nh c√°c n√∫t quy·∫øt ƒë·ªãnh c√≥ th·ªÉ cung c·∫•p ƒë∆∞·ª£c ƒë·∫∑t v√†o c·∫•u tr√∫c `map`, v·ªõi c·∫•u tr√∫c `map` nh∆∞ v·∫≠y c√≥ th·ªÉ tr√≠ch xu·∫•t ra c∆° s·ªü d·ªØ li·ªáu, t·ª´ ƒë√≥ qu·∫£n l√Ω r·∫•t d·ªÖ d√†ng.

#### Ch·ª©c nƒÉng c∆° b·∫£n c·ªßa decision engine

```java
public abstract class EngineBase extends EngineConfig implements IEngine {  
  
    private Logger logger = LoggerFactory.getLogger(EngineBase.class);  
  
    @Override  
    public abstract EngineResult process(Long treeId, String userId, TreeRich treeRich, Map<String, String> decisionMatter);  
  
    protected TreeNode engineDecisionMaker(TreeRich treeRich, Long treeId, String userId, Map<String, String> decisionMatter) {  
        TreeRoot treeRoot = treeRich.getTreeRoot();  
        Map<Long, TreeNode> treeNodeMap = treeRich.getTreeNodeMap();  
        // ID c·ªßa n√∫t g·ªëc c·ªßa c√¢y quy·∫øt ƒë·ªãnh  
        Long rootNodeId = treeRoot.getTreeRootNodeId();  
        TreeNode treeNodeInfo = treeNodeMap.get(rootNodeId);  
        // Lo·∫°i n√∫t [NodeType]Ôºõ1: n√∫t l√°, 2: n√∫t qu·∫£  
        while (treeNodeInfo.getNodeType().equals(1)) {  
            String ruleKey = treeNodeInfo.getRuleKey();  
            LogicFilter logicFilter = logicFilterMap.get(ruleKey);  
            String matterValue = logicFilter.matterValue(treeId, userId, decisionMatter);  
            Long nextNode = logicFilter.filter(matterValue, treeNodeInfo.getTreeNodeLinkList());  
            treeNodeInfo = treeNodeMap.get(nextNode);  
            logger.info("B·ªô m√°y c√¢y quy·∫øt ƒë·ªãnh=>{} userIdÔºö{} treeIdÔºö{} treeNodeÔºö{} ruleKeyÔºö{} matterValueÔºö{}", treeRoot.getTreeName(), userId, treeId, treeNodeInfo.getTreeNodeId(), ruleKey, matterValue);  
        }        return treeNodeInfo;  
    }  
}
```

- ·ªû ƒë√¢y cung c·∫•p ch·ª©c nƒÉng x·ª≠ l√Ω quy tr√¨nh decision tree ch√≠nh, t∆∞∆°ng t·ª± nh∆∞ vi·ªác t√¨m ki·∫øm n√∫t tr√°i c√¢y trong c√¢y nh·ªã ph√¢n th√¥ng qua m·ªëi quan h·ªá d√¢y chuy·ªÅn (`gi·ªõi t√≠nh`, `tu·ªïi`).
- ƒê·ªìng th·ªùi cung c·∫•p m·ªôt ph∆∞∆°ng th·ª©c tr·ª´u t∆∞·ª£ng, ph∆∞∆°ng th·ª©c th·ª±c thi quy tr√¨nh quy·∫øt ƒë·ªãnh ƒë·ªÉ b√™n ngo√†i tri·ªÉn khai c·ª• th·ªÉ.

#### Tri·ªÉn khai c·ªßa decision engine

```java
public class TreeEngineHandle extends EngineBase {

    @Override
    public EngineResult process(Long treeId, String userId, TreeRich treeRich, Map<String, String> decisionMatter) {
        // Quy tr√¨nh quy·∫øt ƒë·ªãnh
        TreeNode treeNode = engineDecisionMaker(treeRich, treeId, userId, decisionMatter);
        // K·∫øt qu·∫£ quy·∫øt ƒë·ªãnh
        return new EngineResult(userId, treeId, treeNode.getTreeNodeId(), treeNode.getNodeValue());
    }

}
```

- ·ªû ƒë√¢y, vi·ªác tri·ªÉn khai c·ªßa m√°y quy·∫øt ƒë·ªãnh r·∫•t ƒë∆°n gi·∫£n, ch·ªâ c·∫ßn s·ª≠ d·ª•ng th√¥ng tin b·∫Øt bu·ªôc ƒë∆∞·ª£c truy·ªÅn v√†o: th√¥ng tin decision tree, gi√° tr·ªã decision matter, ƒë·ªÉ th·ª±c thi quy·∫øt ƒë·ªãnh c·ª• th·ªÉ c·ªßa c·∫•u tr√∫c c√¢y.

### Ki·ªÉm th·ª≠

#### X√¢y d·ª±ng c√¢y

```java
  
public class ApiTest {  
  
    private final Logger logger = LoggerFactory.getLogger(ApiTest.class);  
  
    private TreeRich treeRich;  
  
    @Before  
    public void init() {  
  
        // Node: 1  
        TreeNode treeNode_01 = new TreeNode();  
        treeNode_01.setTreeId(10001L);  
        treeNode_01.setTreeNodeId(1L);  
        treeNode_01.setNodeType(1);  
        treeNode_01.setNodeValue(null);  
        treeNode_01.setRuleKey("userGender");  
        treeNode_01.setRuleDesc("Gi·ªõi t√≠nh ng∆∞·ªùi d√πng [Nam / N·ªØ]");  
  
        // Link: 1->11  
        TreeNodeLink treeNodeLink_11 = new TreeNodeLink();  
        treeNodeLink_11.setNodeIdFrom(1L);  
        treeNodeLink_11.setNodeIdTo(11L);  
        treeNodeLink_11.setRuleLimitType(1);  
        treeNodeLink_11.setRuleLimitValue("man");  
  
        // Link: 1->12  
        TreeNodeLink treeNodeLink_12 = new TreeNodeLink();  
        treeNodeLink_12.setNodeIdFrom(1L);  
        treeNodeLink_12.setNodeIdTo(12L);  
        treeNodeLink_12.setRuleLimitType(1);  
        treeNodeLink_12.setRuleLimitValue("woman");  
  
        List<TreeNodeLink> treeNodeLinkList_1 = new ArrayList<>();  
        treeNodeLinkList_1.add(treeNodeLink_11);  
        treeNodeLinkList_1.add(treeNodeLink_12);  
  
        treeNode_01.setTreeNodeLinkList(treeNodeLinkList_1);  
  
        // Node: 11  
        TreeNode treeNode_11 = new TreeNode();  
        treeNode_11.setTreeId(10001L);  
        treeNode_11.setTreeNodeId(11L);  
        treeNode_11.setNodeType(1);  
        treeNode_11.setNodeValue(null);  
        treeNode_11.setRuleKey("userAge");  
        treeNode_11.setRuleDesc("Tu·ªïi c·ªßa ng∆∞·ªùi d√πng");  
  
        // Link: 11->111  
        TreeNodeLink treeNodeLink_111 = new TreeNodeLink();  
        treeNodeLink_111.setNodeIdFrom(11L);  
        treeNodeLink_111.setNodeIdTo(111L);  
        treeNodeLink_111.setRuleLimitType(3);  
        treeNodeLink_111.setRuleLimitValue("25");  
  
        // Link: 11->112  
        TreeNodeLink treeNodeLink_112 = new TreeNodeLink();  
        treeNodeLink_112.setNodeIdFrom(11L);  
        treeNodeLink_112.setNodeIdTo(112L);  
        treeNodeLink_112.setRuleLimitType(4);  
        treeNodeLink_112.setRuleLimitValue("25");  
  
        List<TreeNodeLink> treeNodeLinkList_11 = new ArrayList<>();  
        treeNodeLinkList_11.add(treeNodeLink_111);  
        treeNodeLinkList_11.add(treeNodeLink_112);  
  
        treeNode_11.setTreeNodeLinkList(treeNodeLinkList_11);  
  
        // Node: 12  
        TreeNode treeNode_12 = new TreeNode();  
        treeNode_12.setTreeId(10001L);  
        treeNode_12.setTreeNodeId(12L);  
        treeNode_12.setNodeType(1);  
        treeNode_12.setNodeValue(null);  
        treeNode_12.setRuleKey("userAge");  
        treeNode_12.setRuleDesc("Tu·ªïi c·ªßa ng∆∞·ªùi d√πng");  
  
        // Link: 12->121  
        TreeNodeLink treeNodeLink_121 = new TreeNodeLink();  
        treeNodeLink_121.setNodeIdFrom(12L);  
        treeNodeLink_121.setNodeIdTo(121L);  
        treeNodeLink_121.setRuleLimitType(3);  
        treeNodeLink_121.setRuleLimitValue("25");  
  
        // Link: 12->122  
        TreeNodeLink treeNodeLink_122 = new TreeNodeLink();  
        treeNodeLink_122.setNodeIdFrom(12L);  
        treeNodeLink_122.setNodeIdTo(122L);  
        treeNodeLink_122.setRuleLimitType(4);  
        treeNodeLink_122.setRuleLimitValue("25");  
  
        List<TreeNodeLink> treeNodeLinkList_12 = new ArrayList<>();  
        treeNodeLinkList_12.add(treeNodeLink_121);  
        treeNodeLinkList_12.add(treeNodeLink_122);  
  
        treeNode_12.setTreeNodeLinkList(treeNodeLinkList_12);  
  
        // Node: 111  
        TreeNode treeNode_111 = new TreeNode();  
        treeNode_111.setTreeId(10001L);  
        treeNode_111.setTreeNodeId(111L);  
        treeNode_111.setNodeType(2);  
        treeNode_111.setNodeValue("K·∫øt qu·∫£ A");  
  
        // Node: 112  
        TreeNode treeNode_112 = new TreeNode();  
        treeNode_112.setTreeId(10001L);  
        treeNode_112.setTreeNodeId(112L);  
        treeNode_112.setNodeType(2);  
        treeNode_112.setNodeValue("K·∫øt qu·∫£ B");  
  
        TreeNode treeNode_121 = new TreeNode();  
        treeNode_121.setTreeId(10001L);  
        treeNode_121.setTreeNodeId(121L);  
        treeNode_121.setNodeType(2);  
        treeNode_121.setNodeValue("K·∫øt qu·∫£ C");  
  
        // Node: 122  
        TreeNode treeNode_122 = new TreeNode();  
        treeNode_122.setTreeId(10001L);  
        treeNode_122.setTreeNodeId(122L);  
        treeNode_122.setNodeType(2);  
        treeNode_122.setNodeValue("K·∫øt qu·∫£ D");  
  
        // Tree root  
        TreeRoot treeRoot = new TreeRoot();  
        treeRoot.setTreeId(10001L);  
        treeRoot.setTreeRootNodeId(1L);  
        treeRoot.setTreeName("C√¢y quy·∫øt ƒë·ªãnh");  
  
        Map<Long, TreeNode> treeNodeMap = new HashMap<>();  
        treeNodeMap.put(1L, treeNode_01);  
        treeNodeMap.put(11L, treeNode_11);  
        treeNodeMap.put(12L, treeNode_12);  
        treeNodeMap.put(111L, treeNode_111);  
        treeNodeMap.put(112L, treeNode_112);  
        treeNodeMap.put(121L, treeNode_121);  
        treeNodeMap.put(122L, treeNode_122);  
  
        treeRich = new TreeRich(treeRoot, treeNodeMap);  
  
    }  

```

- **Quan tr·ªçng**, ph·∫ßn n√†y l√† vi·ªác s·ª≠ d·ª•ng Composite Pattern r·∫•t quan tr·ªçng, d∆∞·ªõi c·∫•u tr√∫c c√¢y quy·∫øt ƒë·ªãnh m√† ch√∫ng ta ƒë√£ x√¢y d·ª±ng, c√≥ th·ªÉ t·∫°o ra c√°c n√∫t c√¢y kh√°c nhau v√† s·ª≠ d·ª•ng c√°c li√™n k·∫øt gi·ªØa c√°c n√∫t ƒë·ªÉ k·∫øt n·ªëi ch√∫ng.
- Ngay c·∫£ sau n√†y n·∫øu b·∫°n c·∫ßn m·ªü r·ªông kinh doanh c·ªßa m√¨nh, b·∫°n c≈©ng c√≥ th·ªÉ th√™m c√°c n√∫t t∆∞∆°ng ·ª©ng v√†o ƒë√¢y v√† th·ª±c hi·ªán c·∫•u h√¨nh ƒë·ªông.
- Ph·∫ßn n√†y v·ªÅ c√°ch t·ªï ch·ª©c th·ªß c√¥ng c√≥ th·ªÉ ƒë∆∞·ª£c tr√≠ch xu·∫•t v√†o c∆° s·ªü d·ªØ li·ªáu, t·ª´ ƒë√≥ b·∫°n c≈©ng c√≥ th·ªÉ m·ªü r·ªông ho·∫°t ƒë·ªông c·∫•u h√¨nh th√¥ng qua giao di·ªán ƒë·ªì h·ªça.

#### Vi·∫øt l·ªõp ki·ªÉm th·ª≠

```java
    
    @Test  
    public void testTree() {  
        logger.info("Th√¥ng tin k·∫øt c·∫•u t·ªï h·ª£p c·ªßa c√¢y quy·∫øt ƒë·ªãnh:\r\n" + JSON.toJSONString(treeRich));  
  
        IEngine treeEngineHandle = new TreeEngineHandle();  
  
        Map<String, String> decisionMatter = new HashMap<>();  
        decisionMatter.put("gender", "man");  
        decisionMatter.put("age", "29");  
  
        EngineResult result = treeEngineHandle.process(10001L, "Oli09pLkdjh", treeRich, decisionMatter);  
        logger.info("K·∫øt qu·∫£ th·ª≠ nghi·ªám: {}", JSON.toJSONString(result));  
  
    }
}
```

- ·ªû ƒë√¢y ƒë√£ cung c·∫•p m·ªôt cu·ªôc g·ªçi th√¥ng qua c√¢y quy·∫øt ƒë·ªãnh ƒë∆∞·ª£c t·∫°o ra th√¥ng qua Composite Pattern, khi g·ªçi, ID c·ªßa c√¢y quy·∫øt ƒë·ªãnh ƒë∆∞·ª£c truy·ªÅn v√†o, v√¨ v·∫≠y trong ph√°t tri·ªÉn kinh doanh, quan h·ªá li√™n k·∫øt gi·ªØa c√¢y quy·∫øt ƒë·ªãnh v√† kinh doanh c√≥ th·ªÉ ƒë∆∞·ª£c t√°ch bi·ªát d·ªÖ d√†ng, ch·ªâ c·∫ßn truy·ªÅn ID c·ªßa c√¢y quy·∫øt ƒë·ªãnh theo nhu c·∫ßu.
- Ngo√†i ra, ƒë·ªëi s·ªë ƒë·∫ßu v√†o c√≤n cung c·∫•p th√¥ng tin c·∫ßn x·ª≠ l√Ω: `nam` (man), `tu·ªïi` (29 tu·ªïi).

#### K·∫øt qu·∫£

```java
2024-03-28 18:18:54.701	INFO	main		(ApiTest.java:165)	|	Th√¥ng tin k·∫øt c·∫•u t·ªï h·ª£p c·ªßa c√¢y quy·∫øt ƒë·ªãnh:
{"treeNodeMap":{112:{"nodeType":2,"nodeValue":"K·∫øt qu·∫£ B","treeId":10001,"treeNodeId":112},1:{"nodeType":1,"ruleDesc":"Gi·ªõi t√≠nh ng∆∞·ªùi d√πng [Nam / N·ªØ]","ruleKey":"userGender","treeId":10001,"treeNodeId":1,"treeNodeLinkList":[{"nodeIdFrom":1,"nodeIdTo":11,"ruleLimitType":1,"ruleLimitValue":"man"},{"nodeIdFrom":1,"nodeIdTo":12,"ruleLimitType":1,"ruleLimitValue":"woman"}]},121:{"nodeType":2,"nodeValue":"K·∫øt qu·∫£ C","treeId":10001,"treeNodeId":121},122:{"nodeType":2,"nodeValue":"K·∫øt qu·∫£ D","treeId":10001,"treeNodeId":122},11:{"nodeType":1,"ruleDesc":"Tu·ªïi c·ªßa ng∆∞·ªùi d√πng","ruleKey":"userAge","treeId":10001,"treeNodeId":11,"treeNodeLinkList":[{"nodeIdFrom":11,"nodeIdTo":111,"ruleLimitType":3,"ruleLimitValue":"25"},{"nodeIdFrom":11,"nodeIdTo":112,"ruleLimitType":4,"ruleLimitValue":"25"}]},12:{"nodeType":1,"ruleDesc":"Tu·ªïi c·ªßa ng∆∞·ªùi d√πng","ruleKey":"userAge","treeId":10001,"treeNodeId":12,"treeNodeLinkList":[{"nodeIdFrom":12,"nodeIdTo":121,"ruleLimitType":3,"ruleLimitValue":"25"},{"nodeIdFrom":12,"nodeIdTo":122,"ruleLimitType":4,"ruleLimitValue":"25"}]},111:{"nodeType":2,"nodeValue":"K·∫øt qu·∫£ A","treeId":10001,"treeNodeId":111}},"treeRoot":{"treeId":10001,"treeName":"C√¢y quy·∫øt ƒë·ªãnh","treeRootNodeId":1}}
2024-03-28 18:18:54.708	INFO	main		(EngineBase.java:33)	|	B·ªô m√°y c√¢y quy·∫øt ƒë·ªãnh=>C√¢y quy·∫øt ƒë·ªãnh userIdÔºöOli09pLkdjh treeIdÔºö10001 treeNodeÔºö11 ruleKeyÔºöuserGender matterValueÔºöman
2024-03-28 18:18:54.708	INFO	main		(EngineBase.java:33)	|	B·ªô m√°y c√¢y quy·∫øt ƒë·ªãnh=>C√¢y quy·∫øt ƒë·ªãnh userIdÔºöOli09pLkdjh treeIdÔºö10001 treeNodeÔºö112 ruleKeyÔºöuserAge matterValueÔºö29
2024-03-28 18:18:54.712	INFO	main		(ApiTest.java:174)	|	K·∫øt qu·∫£ th·ª≠ nghi·ªám: {"nodeId":112,"nodeValue":"K·∫øt qu·∫£ B","success":true,"treeId":10001,"userId":"Oli09pLkdjh"}

```

- T·ª´ k·∫øt qu·∫£ ki·ªÉm tra, c√≥ v·∫ª gi·ªëng nh∆∞ vi·ªác s·ª≠ d·ª•ng `ifelse`, nh∆∞ng d∆∞·ªõi thi·∫øt k·∫ø c·ªßa Composite Pattern hi·ªán t·∫°i, vi·ªác m·ªü r·ªông v√† ch·ªânh s·ª≠a sau n√†y s·∫Ω r·∫•t thu·∫≠n ti·ªán.
- T·ªï ch·ª©c c·∫•u tr√∫c v√† vi·ªác g·ªçi quy tr√¨nh quy·∫øt ƒë·ªãnh ƒë√£ ƒë∆∞·ª£c thi·∫øt l·∫≠p, n·∫øu b·∫°n kh√¥ng hi·ªÉu ho√†n to√†n ·ªü ƒë√¢y, b·∫°n c√≥ th·ªÉ t·∫£i code v√† quan s√°t c·∫•u tr√∫c v√† ch·∫°y g·ª° l·ªói.

## T·ªïng k·∫øt

- D·ª±a tr√™n k·ªãch b·∫£n c√¢y quy·∫øt ƒë·ªãnh tr√™n, Composite Pattern ch·ªß y·∫øu gi·∫£i quy·∫øt vi·ªác s·ª≠ d·ª•ng m·ªôt chu·ªói c√°c n√∫t logic ƒë∆°n gi·∫£n ho·∫∑c m·ªü r·ªông c·ªßa c√°c n√∫t logic ph·ª©c t·∫°p trong c√°c c·∫•u tr√∫c kh√°c nhau v√† v·∫´n c√≥ th·ªÉ r·∫•t d·ªÖ d√†ng ƒë·ªÉ g·ªçi t·ª´ b√™n ngo√†i.
- M√¥ h√¨nh thi·∫øt k·∫ø n√†y ƒë·∫£m b·∫£o nguy√™n t·∫Øc m·ªü ƒë√≥ng, b·∫°n c√≥ th·ªÉ cung c·∫•p c√°c n√∫t logic m·ªõi v√† k·∫øt h·ª£p ch√∫ng ƒë·ªÉ t·∫°o ra c√¢y quy·∫øt ƒë·ªãnh m·ªõi m√† kh√¥ng c·∫ßn thay ƒë·ªïi c·∫•u tr√∫c m√¥ h√¨nh. Tuy nhi√™n, n·∫øu g√≥i m·ªôt s·ªë interface c√≥ s·ª± kh√°c bi·ªát l·ªõn trong ch·ª©c nƒÉng, vi·ªác x·ª≠ l√Ω s·∫Ω tr·ªü n√™n kh√≥ khƒÉn h∆°n, nh∆∞ng v·∫´n c√≥ th·ªÉ x·ª≠ l√Ω t·ªët, ch·ªâ c·∫ßn th·ª±c hi·ªán m·ªôt s·ªë ƒëi·ªÅu ch·ªânh v√† ph√°t tri·ªÉn c·ª• th·ªÉ.
- ƒê√¥i khi, b·ªüi v√¨ s·ª± ho√†n h·∫£o v√† tinh th·∫ßn th·ª£ th·ªß c√¥ng h∆°i c·ª©ng nh·∫Øc c·ªßa b·∫°n, ngay c·∫£ khi ƒë·ªëi m·∫∑t v·ªõi c√πng m·ªôt y√™u c·∫ßu, b·∫°n c√≥ th·ªÉ t·∫°o ra c·∫•u tr√∫c code t·ªët nh·∫•t v√† ki·∫øn ‚Äã‚Äãtr√∫c c√¥ng ngh·ªá d·ªÖ m·ªü r·ªông nh·∫•t. `ƒê·ª´ng ƒë·ªÉ ·∫£nh h∆∞·ªüng c·ªßa ng∆∞·ªùi kh√¥ng th·ªÉ cung c·∫•p cho b·∫°n s·ª± c·∫£i thi·ªán v·ªÅ kh·∫£ nƒÉng l√†m vi·ªác c·ªßa b·∫°n!`
