---
title: Skywalking Monitoring
tags:
  - java
  - microservice
categories:
  - project
order: 7
---
# PmHub - Distributed monitoring & tracing with Skywalking

B√†i vi·∫øt n√†y ch·ªß y·∫øu h∆∞·ªõng d·∫´n c√°ch s·ª≠ d·ª•ng **Skywalking** trong **PmHub** ƒë·ªÉ gi√°m s√°t hi·ªáu su·∫•t v√† truy v·∫øt ph√¢n t√°n. N·ªôi dung s·∫Ω b·∫Øt ƒë·∫ßu t·ª´ nh·ªØng ki·∫øn th·ª©c c∆° b·∫£n, ƒë·∫øn d·ª± √°n th·ª±c t·∫ø v√† h∆∞·ªõng d·∫´n t√≠ch h·ª£p t·ª´ 0-1. B√†i vi·∫øt c≈©ng s·∫Ω ch·ªâ ra c√°ch d√πng **traceid** ƒë·ªÉ x√°c ƒë·ªãnh c√°c v·∫•n ƒë·ªÅ trong chu·ªói d·ªãch v·ª• ph√¢n t√°n. Cu·ªëi c√πng, s·∫Ω c√≥ c√°c c√¢u h·ªèi gi√∫p b·∫°n **n·∫Øm v·ªØng c√°ch s·ª≠ d·ª•ng th·ª±c t·∫ø Skywalking**.

::: info
ƒê√£ tri·ªÉn khai Skywalking ƒë·ªÉ gi√°m s√°t hi·ªáu su·∫•t v√† truy v·∫øt ph√¢n t√°n cho PmHub, t√≠ch h·ª£p c√°c k√™nh th√¥ng b√°o qua email, v.v., gi√∫p gi·∫£m kho·∫£ng 30% th·ªùi gian ph·∫£n h·ªìi c·ªßa h·ªá th·ªëng, ƒë·∫£m b·∫£o t√≠nh ·ªïn ƒë·ªãnh v√† d·ªÖ b·∫£o tr√¨.
:::

## T·ªïng quan v·ªÅ truy v·∫øt chu·ªói d·ªãch v·ª• ph√¢n t√°n

Trong h·ªá th·ªëng microservice, d·ªãch v·ª• A g·ªçi d·ªãch v·ª• B, B l·∫°i g·ªçi d·ªãch v·ª• C, v√† C ti·∫øp t·ª•c g·ªçi D, ƒëi·ªÅu n√†y l√†m chu·ªói d·ªãch v·ª• tr·ªü n√™n r·∫•t ph·ª©c t·∫°p.

M·ªôt request t·ª´ client s·∫Ω ƒëi qua nhi·ªÅu node d·ªãch v·ª• kh√°c nhau trong h·ªá th·ªëng ƒë·ªÉ t·∫°o ra k·∫øt qu·∫£ cu·ªëi c√πng. M·ªói y√™u c·∫ßu nh∆∞ v·∫≠y s·∫Ω h√¨nh th√†nh m·ªôt chu·ªói d·ªãch v·ª• ph√¢n t√°n ph·ª©c t·∫°p. B·∫•t k·ª≥ s·ª± ch·∫≠m tr·ªÖ ho·∫∑c l·ªói n√†o trong m·ªôt node c·ªßa chu·ªói c≈©ng c√≥ th·ªÉ khi·∫øn request cu·ªëi c√πng th·∫•t b·∫°i.

![image.png](https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240917182929.png)

Trong h·ªá th·ªëng ph√¢n t√°n, c·∫ßn c√≥ m·ªôt c∆° ch·∫ø chuy√™n bi·ªát ƒë·ªÉ theo d√µi c√°c chu·ªói n√†y.

Hi·ªán nay, c√°c c√¥ng c·ª• ph·ªï bi·∫øn cho vi·ªác n√†y bao g·ªìm **Sleuth**, **Skywalking**, v√† **Zipkin**. Tuy nhi√™n, [Sleuth](https://spring.io/projects/spring-cloud-sleuth) ƒë√£ th√¥ng b√°o s·∫Ω thay ƒë·ªïi c·∫•u tr√∫c. üòÇ

> Spring Cloud Sleuth‚Äôs last minor version is 3.1. You can check the¬†[3.1.x](https://github.com/spring-cloud/spring-cloud-sleuth/tree/3.1.x)¬†branch for the latest commits. The core of this project got moved to¬†[Micrometer Tracing](https://micrometer.io/docs/tracing)¬†project and the instrumentations will be moved to¬†[Micrometer](https://micrometer.io/)¬†and all respective projects (no longer all instrumentations will be done in a single repository).

D∆∞·ªõi ƒë√¢y l√† m·ªôt s·ªë gi·∫£i ph√°p truy v·∫øt chu·ªói d·ªãch v·ª• ph√¢n t√°n ƒë√£ ph√°t tri·ªÉn trong ng√†nh.

| Tech       | M√¥ t·∫£                                                                                                                                                                                                                                                                                                                                                                            |
| ---------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Cat        | Ngu·ªìn m·ªü c·ªßa Dianping, m·ªôt n·ªÅn t·∫£ng gi√°m s√°t ·ª©ng d·ª•ng th·ªùi gian th·ª±c ƒë∆∞·ª£c ph√°t tri·ªÉn d·ª±a tr√™n Java, bao g·ªìm gi√°m s√°t ·ª©ng d·ª•ng th·ªùi gian th·ª±c v√† gi√°m s√°t kinh doanh. Gi·∫£i ph√°p t√≠ch h·ª£p l√† tri·ªÉn khai gi√°m s√°t th√¥ng qua c√°c ƒëi·ªÉm ch√¥n m√£, ch·∫≥ng h·∫°n nh∆∞ b·ªô ch·∫∑n, b·ªô l·ªçc, v.v. N√≥ r·∫•t x√¢m ph·∫°m v√†o m√£ v√† chi ph√≠ t√≠ch h·ª£p cao. R·ªßi ro l·ªõn h∆°n.                                   |
| Zipkin     | ƒê∆∞·ª£c m√£ ngu·ªìn m·ªü b·ªüi Twitter, h·ªá th·ªëng theo d√µi ph√¢n t√°n m√£ ngu·ªìn m·ªü ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ thu th·∫≠p d·ªØ li·ªáu th·ªùi gian c·ªßa c√°c d·ªãch v·ª• nh·∫±m gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ ƒë·ªô tr·ªÖ trong ki·∫øn ‚Äã‚Äãtr√∫c microservice, bao g·ªìm: thu th·∫≠p, l∆∞u tr·ªØ, t√¨m ki·∫øm v√† hi·ªÉn th·ªã d·ªØ li·ªáu, k·∫øt h·ª£p v·ªõi spring-cloud-sleuth t∆∞∆°ng ƒë·ªëi ƒë∆°n gi·∫£n d·ªÖ s·ª≠ d·ª•ng v√† d·ªÖ t√≠ch h·ª£p, nh∆∞ng ch·ª©c nƒÉng c·ªßa n√≥ t∆∞∆°ng ƒë·ªëi ƒë∆°n gi·∫£n. |
| Pinpoint   | Pinpoint l√† m·ªôt c√¥ng c·ª• ph√¢n t√≠ch gi√°m s√°t ·ª©ng d·ª•ng v√† ph√¢n t√≠ch chu·ªói cu·ªôc g·ªçi ngu·ªìn m·ªü d·ª±a tr√™n vi·ªác ti√™m m√£ byte. N√≥ ƒë∆∞·ª£c ƒë·∫∑c tr∆∞ng b·ªüi vi·ªác h·ªó tr·ª£ nhi·ªÅu plug-in kh√°c nhau, c√°c ch·ª©c nƒÉng giao di·ªán ng∆∞·ªùi d√πng m·∫°nh m·∫Ω v√† kh√¥ng c√≥ s·ª± x√¢m nh·∫≠p m√£ ·ªü ƒë·∫ßu truy c·∫≠p.                                                                                                            |
| Skywalking | SkyWalking l√† m·ªôt c√¥ng c·ª• ph√¢n t√≠ch gi√°m s√°t ·ª©ng d·ª•ng v√† ph√¢n t√≠ch chu·ªói cu·ªôc g·ªçi m√£ ngu·ªìn m·ªü c·ªßa Trung Qu·ªëc d·ª±a tr√™n vi·ªác ti√™m bytecode. N√≥ c√≥ ƒë·∫∑c ƒëi·ªÉm l√† h·ªó tr·ª£ nhi·ªÅu plug-in kh√°c nhau, ch·ª©c nƒÉng giao di·ªán ng∆∞·ªùi d√πng m·∫°nh m·∫Ω v√† kh√¥ng c√≥ s·ª± x√¢m nh·∫≠p m√£ ·ªü ƒë·∫ßu truy c·∫≠p.                                                                                                    |

## Nguy√™n l√Ω truy v·∫øt chu·ªói d·ªãch v·ª• ph√¢n t√°n

Gi·∫£ s·ª≠ m·ªôt chu·ªói d·ªãch v·ª• microservice c√≥ ba th√†nh ph·∫ßn nh∆∞ h√¨nh d∆∞·ªõi ƒë√¢y: **Service 1** g·ªçi **Service 2**, **Service 2** g·ªçi **Service 3** v√† **Service 4**.

![image.png](https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240917183735.png)

M·ªôt chu·ªói truy v·∫øt s·∫Ω th√™m **Trace ID** v√† **Span ID** v√†o m·ªói l·∫ßn g·ªçi d·ªãch v·ª•.

Chu·ªói truy v·∫øt ƒë∆∞·ª£c x√°c ƒë·ªãnh duy nh·∫•t qua **Trace ID**.

**Span** x√°c ƒë·ªãnh th√¥ng tin v·ªÅ m·ªói l·∫ßn y√™u c·∫ßu, c√°c **span** ƒë∆∞·ª£c li√™n k·∫øt v·ªõi nhau qua **Parent ID**. **Span** ƒë·∫°i di·ªán cho m·ªôt l·∫ßn y√™u c·∫ßu, v√† c√≥ th·ªÉ hi·ªÉu ƒë∆°n gi·∫£n n√≥ l√† th√¥ng tin c·ªßa m·ªôt l·∫ßn g·ªçi.

M·ªôt chu·ªói truy v·∫øt ƒë∆∞·ª£c x√°c ƒë·ªãnh qua **Trace ID**, m·ªói **Span** ƒë·∫°i di·ªán cho th√¥ng tin c·ªßa m·ªôt l·∫ßn y√™u c·∫ßu v√† ƒë∆∞·ª£c li√™n k·∫øt v·ªõi **Parent ID**.

![image.png](https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240917192542.png)

|     |                                                                                                             |
| --- | ----------------------------------------------------------------------------------------------------------- |
| 1   | N√∫t ƒë·∫ßu ti√™n: Span ID = A, Parent ID = null, Service 1 nh·∫≠n y√™u c·∫ßu.                                        |
| 2   | N√∫t th·ª© hai: Span ID = B, Parent ID = A, Service 1 g·ª≠i y√™u c·∫ßu t·ªõi Service 2 v√† nh·∫≠n ph·∫£n h·ªìi t·ª´ Service 2. |
| 3   | N√∫t th·ª© ba: Span ID = C, Parent ID = B, qu√° tr√¨nh x·ª≠ l√Ω t·∫°i Service 2.                                      |
| 4   | N√∫t th·ª© t∆∞: Span ID = D, Parent ID = C, Service 2 g·ª≠i y√™u c·∫ßu ƒë·∫øn Service 3 v√† nh·∫≠n ph·∫£n h·ªìi t·ª´ Service 3.  |
| 5   | N√∫t th·ª© nƒÉm: Span ID = E, Parent ID = D, qu√° tr√¨nh x·ª≠ l√Ω t·∫°i Service 3.                                     |
| 6   | N√∫t th·ª© s√°u: Span ID = F, Parent ID = C, Service 3 g·ª≠i y√™u c·∫ßu ƒë·∫øn Service 4 v√† nh·∫≠n ph·∫£n h·ªìi t·ª´ Service 4. |
| 7   | N√∫t th·ª© b·∫£y: Span ID = G, Parent ID = F, qu√° tr√¨nh x·ª≠ l√Ω t·∫°i Service 4.                                     |
| 8   | Qua Parent ID, c√≥ th·ªÉ x√°c ƒë·ªãnh ƒë∆∞·ª£c n√∫t cha, gi√∫p truy v·∫øt to√†n b·ªô chu·ªói d·ªãch v·ª•.                           |

### Skywalking l√† g√¨?

**Skywalking** l√† m·ªôt **khung m√£ ngu·ªìn m·ªü** tuy·ªát v·ªùi, ƒë∆∞·ª£c open source v√†o nƒÉm 2015 v√† gia nh·∫≠p Apache Incubator v√†o nƒÉm 2017. Ch·ªâ trong hai nƒÉm ng·∫Øn ng·ªßi, Skywalking ƒë√£ ƒë∆∞·ª£c Apache ƒë√≥n nh·∫≠n, ch·ª©ng minh s·ª©c m·∫°nh c·ªßa n√≥. üëç

Skywalking h·ªó tr·ª£ t√≠ch h·ª£p v·ªõi **Dubbo**, **SpringCloud**, **SpringBoot** m√† **kh√¥ng x√¢m ph·∫°m m√£**. N√≥ s·ª≠ d·ª•ng **GRPC** cho giao ti·∫øp, ƒë·∫£m b·∫£o hi·ªáu su·∫•t t·ªët. Skywalking ƒë∆∞·ª£c tri·ªÉn khai d∆∞·ªõi d·∫°ng Java agent, h·ªó tr·ª£ c·∫£nh b√°o, gi√°m s√°t JVM, v√† cung c·∫•p c√°c th·ªëng k√™ g·ªçi to√†n c·ª•c, c√πng nhi·ªÅu t√≠nh nƒÉng kh√°c. Ngo√†i ra, c·ªông ƒë·ªìng ph√°t tri·ªÉn c·ªßa Skywalking c≈©ng kh√° s√¥i ƒë·ªông.

Trang web ch√≠nh th·ª©c: [https://skywalking.apache.org/](https://skywalking.apache.org/)  
M√£ ngu·ªìn m·ªü: [https://github.com/apache/skywalking](https://github.com/apache/skywalking)

### T·∫°i sao ch·ªçn Skywalking?

::: info
Skywalking c√≥ nhi·ªÅu ∆∞u ƒëi·ªÉm so v·ªõi Zipkin, ch·∫≥ng h·∫°n nh∆∞:

- Skywalking s·ª≠ d·ª•ng c√¥ng ngh·ªá tƒÉng c∆∞·ªùng bytecode, kh√¥ng x√¢m ph·∫°m m√£, trong khi Zipkin c√≥ t√≠nh x√¢m ph·∫°m cao.
- Skywalking c√≥ nhi·ªÅu t√≠nh nƒÉng phong ph√∫ h∆°n, c√°c b√°o c√°o th·ªëng k√™ v√† giao di·ªán ng∆∞·ªùi d√πng (UI) th√¢n thi·ªán h∆°n.
:::

### Ki·∫øn tr√∫c c·ªßa Skywalking

Skywalking ch·ªß y·∫øu chia th√†nh hai ph·∫ßn: **m√°y ch·ªß** v√† **m√°y kh√°ch**. M√°y ch·ªß ch·∫°y ƒë·ªôc l·∫≠p, c√≤n m√°y kh√°ch ch√≠nh l√† c√°c d·ªãch v·ª• microservice c·ªßa b·∫°n. Ch·ªâ c·∫ßn th√™m c√°c g√≥i jar v√† c·∫•u h√¨nh l√† c√≥ th·ªÉ s·ª≠ d·ª•ng.

![S∆° ƒë·ªì ki·∫øn tr√∫c](https://skywalking.apache.org/images/home/architecture_2160x720.png)

S∆° ƒë·ªì ki·∫øn tr√∫c c·ª• th·ªÉ nh∆∞ sau:

![arch](https://skywalking.apache.org/blog/2018-12-12-skywalking-service-mesh-ready/0081Kckwly1gl2ctge1g5j31pc0s8h04.jpg)

C·ª• th·ªÉ, ki·∫øn tr√∫c bao g·ªìm b·ªën ph·∫ßn ch√≠nh:

1. **Agent**: Thu th·∫≠p d·ªØ li·ªáu log v√† g·ª≠i t·ªõi m√°y ch·ªß OAP.
2. **OAP Server**: Nh·∫≠n d·ªØ li·ªáu v·ªÅ truy v·∫øt (Tracing) v√† s·ªë li·ªáu (Metric) t·ª´ Agent, sau ƒë√≥ ph√¢n t√≠ch (Analysis Core), l∆∞u tr·ªØ v√†o c∆° s·ªü d·ªØ li·ªáu ngo√†i (Storage), v√† cung c·∫•p ch·ª©c nƒÉng truy v·∫•n (Query).
3. **UI**: Cung c·∫•p b·∫£ng ƒëi·ªÅu khi·ªÉn web ƒë·ªÉ xem chu·ªói d·ªãch v·ª•, c√°c ch·ªâ s·ªë, hi·ªáu su·∫•t, v.v.
4. **Storage**: L∆∞u tr·ªØ d·ªØ li·ªáu, h·ªó tr·ª£ nhi·ªÅu lo·∫°i c∆° s·ªü d·ªØ li·ªáu kh√°c nhau.

Sau khi hi·ªÉu s∆° ƒë·ªì ki·∫øn tr√∫c, ta th·∫•y r·∫±ng Agent ch·ªãu tr√°ch nhi·ªám thu th·∫≠p log v√† truy·ªÅn d·ªØ li·ªáu qua GRPC ƒë·∫øn OAP ƒë·ªÉ ph√¢n t√≠ch v√† l∆∞u tr·ªØ v√†o c∆° s·ªü d·ªØ li·ªáu. Cu·ªëi c√πng, UI s·∫Ω hi·ªÉn th·ªã c√°c b√°o c√°o th·ªëng k√™, quan h·ªá ph·ª• thu·ªôc d·ªãch v·ª• v√† s∆° ƒë·ªì topology.

### C√†i ƒë·∫∑t m√°y ch·ªß

T·∫£i xu·ªëng t·∫°i: [https://skywalking.apache.org/downloads/](https://skywalking.apache.org/downloads/)

B·∫°n c√≥ th·ªÉ ch·ªçn phi√™n b·∫£n m·ªõi nh·∫•t ƒë·ªÉ t·∫£i v·ªÅ, nh∆∞ng l∆∞u √Ω:

::: info
V√¨ PmHub hi·ªán v·∫´n s·ª≠ d·ª•ng **JDK 8**, trong khi **Skywalking** y√™u c·∫ßu JDK 11 tr·ªü l√™n, n√™n ƒë·ªÉ tr√°nh c√°c v·∫•n ƒë·ªÅ kh√¥ng t∆∞∆°ng th√≠ch, khuy·∫øn ngh·ªã s·ª≠ d·ª•ng phi√™n b·∫£n Skywalking th·∫•p h∆°n. ·ªû ƒë√¢y, t√¥i s·ª≠ d·ª•ng **8.3.0**. Sau n√†y, n·∫øu n√¢ng c·∫•p l√™n phi√™n b·∫£n JDK m·ªõi h∆°n, c√°c v·∫•n ƒë·ªÅ t∆∞∆°ng th√≠ch s·∫Ω ƒë∆∞·ª£c gi·∫£i quy·∫øt.
:::

::: info
T·ª´ phi√™n b·∫£n **Skywalking 8.7.0** tr·ªü ƒëi, m√£ c·ªßa agent ƒë√£ ƒë∆∞·ª£c t√°ch kh·ªèi Skywalking, b·∫°n c·∫ßn t·ª± t·∫£i agent t∆∞∆°ng ·ª©ng t·ª´ trang web ch√≠nh th·ª©c: [https://skywalking.apache.org/downloads/](https://skywalking.apache.org/downloads/).

C√°ch ch·ªçn phi√™n b·∫£n agent ph√π h·ª£p c√≥ th·ªÉ t√¨m th·∫•y t·∫°i: [https://skywalking.apache.org/docs/skywalking-java/v9.0.0/en/setup/service-agent/java-agent/readme/](https://skywalking.apache.org/docs/skywalking-java/v9.0.0/en/setup/service-agent/java-agent/readme/)

V√¨ phi√™n b·∫£n m√°y ch·ªß l√† **9.5.0**, agent t∆∞∆°ng ·ª©ng s·∫Ω l√† **9.0.0**.
:::

### 1. S·ª≠a c·∫•u h√¨nh `config/application.yml`

ƒê√¢y l√† t·ªáp c·∫•u h√¨nh c·ªßa d·ªãch v·ª• OAP, c·∫ßn ch·ªânh s·ª≠a trung t√¢m ƒëƒÉng k√Ω th√†nh Nacos.

![image.png](https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240917201418.png)


Ch·ªânh s·ª≠a c·∫•u h√¨nh Nacos:

![image.png](https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240917201438.png)

### 2. S·ª≠a c·∫•u h√¨nh `webapp/webapp.yml` (ho·∫∑c `application.yml`)

ƒê√¢y l√† t·ªáp c·∫•u h√¨nh c·ªßa d·ªãch v·ª• UI, trong ƒë√≥ c√≥ m·ªôt c·∫•u h√¨nh `server.port`, ƒë√¢y l√† c·ªïng c·ªßa d·ªãch v·ª• UI, m·∫∑c ƒë·ªãnh l√† 8080. H√£y thay ƒë·ªïi th√†nh 8888 ƒë·ªÉ tr√°nh xung ƒë·ªôt c·ªïng, nh∆∞ sau:

![image.png](https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240917201449.png)

Kh·ªüi ƒë·ªông:

```bash
sh startup.sh 
```

T·∫Øt:

```bash
lsof -i :8888
kill -9 pid
```

Sau khi kh·ªüi ƒë·ªông ho√†n t·∫•t v√† kh√¥ng c√≥ l·ªói, b·∫°n c√≥ th·ªÉ truy c·∫≠p b·∫±ng tr√¨nh duy·ªát qua ƒë·ªãa ch·ªâ: [http://localhost:8888/](http://localhost:8888/)

::: warning
Phi√™n b·∫£n m·ªõi c·∫ßn √≠t nh·∫•t JDK 11 h·ªó tr·ª£.

B·∫°n c·∫ßn qu·∫£n l√Ω nhi·ªÅu phi√™n b·∫£n java tr√™n m·ªôt m√°y (linux/mac), b·∫°n c√≥ th·ªÉ s·ª≠ d·ª•ng [jenv](https://github.com/jenv/jenv). H√£y t√¨m hi·ªÉu n√≥!
:::

## Th·ª±c chi·∫øn d·ª± √°n
### C√†i ƒë·∫∑t ph√≠a Client

Ph√≠a client, t·ª©c l√† c√°ch m·ªôt microservice t√≠ch h·ª£p v·ªõi Skywalking. V√¨ Skywalking s·ª≠ d·ª•ng c√¥ng ngh·ªá tƒÉng c∆∞·ªùng m√£ byte, n√™n n√≥ kh√¥ng x√¢m nh·∫≠p m√£ c·ªßa microservice. Ch·ªâ c·∫ßn m·ªôt microservice b√¨nh th∆∞·ªùng, kh√¥ng c·∫ßn th√™m b·∫•t k·ª≥ ph·ª• thu·ªôc n√†o.

ƒê·ªÉ truy·ªÅn d·ªØ li·ªáu, c·∫ßn s·ª≠ d·ª•ng agent do Skywalking cung c·∫•p. B·∫°n ch·ªâ c·∫ßn ch·ªâ ƒë·ªãnh trong tham s·ªë kh·ªüi ƒë·ªông nh∆∞ sau:

```java
-javaagent:/Users/canghe/tools/skywalking/apache-skywalking-apm-bin/agent/skywalking-agent.jar
-Dskywalking.agent.service_name=pmhub-gateway
-Dskywalking.collector.backend_service=127.0.0.1:11800
```

::: info
+ `-javaagent`: Ch·ªâ ƒë·ªãnh ƒë∆∞·ªùng d·∫´n ƒë·∫øn t·ªáp skywalking-agent.jar trong th∆∞ m·ª•c agent c·ªßa Skywalking.
+ `-Dskywalking.agent.service_name`: Ch·ªâ ƒë·ªãnh t√™n d·ªãch v·ª• trong Skywalking, th√¥ng th∆∞·ªùng l√† `spring.application.name` c·ªßa microservice.
+ `-Dskywalking.collector.backend_service`: Ch·ªâ ƒë·ªãnh ƒë·ªãa ch·ªâ c·ªßa d·ªãch v·ª• OAP, n·∫øu l√† local, c·ªïng m·∫∑c ƒë·ªãnh c·ªßa d·ªãch v·ª• OAP l√† 11800, v√¨ v·∫≠y ch·ªâ c·∫ßn c·∫•u h√¨nh th√†nh `127.0.0.1:11800`.

L∆∞u √Ω: ƒê∆∞·ªùng d·∫´n ƒë·∫øn t·ªáp jar c·ªßa agent kh√¥ng ƒë∆∞·ª£c ch·ª©a k√Ω t·ª± ƒë·∫∑c bi·ªát ho·∫∑c kho·∫£ng tr·∫Øng, n·∫øu kh√¥ng s·∫Ω kh√¥ng th·ªÉ ch·∫°y th√†nh c√¥ng.
:::

L∆∞u √Ω: Trong phi√™n b·∫£n m·ªõi c·ªßa IntelliJ IDEA, b·∫°n th√™m VM options nh∆∞ sau:

![image.png](https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240917212727.png)
![image.png](https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240917212750.png)

![image.png](https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240917212849.png)

Sau khi c·∫•u h√¨nh xong, b·∫°n c√≥ th·ªÉ th·∫•y d·ªãch v·ª• ƒë√£ ƒë∆∞·ª£c agent theo d√µi.

### Gi√°m s√°t log

Trong giao di·ªán ng∆∞·ªùi d√πng c·ªßa Skywalking c√≥ m·ªôt module d√†nh cho log, ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ thu th·∫≠p log t·ª´ ph√≠a client. M·∫∑c ƒë·ªãnh, kh√¥ng c√≥ d·ªØ li·ªáu trong module n√†y, v·∫≠y l√†m th·∫ø n√†o ƒë·ªÉ truy·ªÅn d·ªØ li·ªáu log v√†o Skywalking?

C√≥ r·∫•t nhi·ªÅu lo·∫°i framework log, n·ªïi ti·∫øng nh∆∞ log4j, logback, log4j2. Sau ƒë√¢y l√† c√°ch c·∫•u h√¨nh v·ªõi logback l√†m v√≠ d·ª•.

**Ch·ªânh s·ª≠a m·ª©c ƒë·ªô log c·ªßa agent:**

ƒê·ªÉ tr√°nh vi·ªác in qu√° nhi·ªÅu log info tr√™n console, c·∫ßn thay ƒë·ªïi m·ª©c ƒë·ªô log. T·ªáp c·∫•u h√¨nh log c·ªßa SkyWalking th∆∞·ªùng n·∫±m trong `agent/config/agent.config`. T√¨m v√† m·ªü t·ªáp n√†y.

T√¨m c·∫•u h√¨nh sau v√† ƒë·∫∑t m·ª©c ƒë·ªô log ph√π h·ª£p, ch·∫≥ng h·∫°n nh∆∞ `ERROR` ho·∫∑c `WARN`, ƒë·ªÉ gi·∫£m l∆∞·ª£ng log ƒë∆∞·ª£c ghi l·∫°i:

![image.png](https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240917220047.png)


**Th√™m ph·ª• thu·ªôc:**

> **V√¨ m·ªói microservice ƒë·ªÅu c·∫ßn d√πng ƒë·∫øn c·∫•u h√¨nh n√†y, n√™n c√≥ th·ªÉ ƒë·∫∑t trong module chung ƒë·ªÉ c√°c d·ªãch v·ª• kh√°c ch·ªâ c·∫ßn tham chi·∫øu.**

```java
<!-- N·∫øu b·∫°n mu·ªën l·∫•y TraceId trong m√£ d·ª± √°n, c·∫ßn th√™m ph·ª• thu·ªôc n√†y -->
<dependency>
    <groupId>org.apache.skywalking</groupId>
    <artifactId>apm-toolkit-trace</artifactId>
    <version>8.8.0</version>
</dependency>
<!-- Ch·ª©c nƒÉng t√πy ch·ªânh li√™n quan, ch·∫≥ng h·∫°n nh∆∞ th·∫ª t√πy ch·ªânh -->
<dependency>
    <groupId>org.apache.skywalking</groupId>
    <artifactId>apm-toolkit-opentracing</artifactId>
    <version>8.8.0</version>
</dependency>
<!-- plugin logback ghi log skywalking -->
<dependency>
    <groupId>org.apache.skywalking</groupId>
    <artifactId>apm-toolkit-logback-1.x</artifactId>
    <version>8.8.0</version>
</dependency>
```

**Th√™m c·∫•u h√¨nh thu th·∫≠p log v√†o logback.xml:**

```java
<?xml version="1.0" encoding="UTF-8"?>

<configuration scan="true" scanPeriod="5 seconds">
    <!-- Thu th·∫≠p log skywalking -->
    <appender name="grpc-log" class="org.apache.skywalking.apm.toolkit.log.logback.v1.x.log.GRPCLogClientAppender">
        <encoder class="ch.qos.logback.core.encoder.LayoutWrappingEncoder">
            <layout class="org.apache.skywalking.apm.toolkit.log.logback.v1.x.mdc.TraceIdMDCPatternLogbackLayout">
                <Pattern>%d{yyyy-MM-dd HH:mm:ss.SSS} [%X{tid}] [%thread] %-5level %logger{36} -%msg%n</Pattern>
            </layout>
        </encoder>
    </appender>

    <root level="INFO">
        <appender-ref ref="grpc-log"/>
    </root>
</configuration>
```

Sau khi c·∫•u h√¨nh xong, log s·∫Ω hi·ªÉn th·ªã tr·ª±c ti·∫øp tr√™n giao di·ªán ng∆∞·ªùi d√πng. B·∫°n c√≥ th·ªÉ nh·∫•p v√†o c√°c trang nh∆∞ theo d√µi chu·ªói, ph√¢n t√≠ch hi·ªáu nƒÉng ƒë·ªÉ tr·∫£i nghi·ªám c√¥ng c·ª• m·∫°nh m·∫Ω n√†y. Ngo√†i ra, c√≥ th·ªÉ c·∫•u h√¨nh c·∫£nh b√°o t√πy ch·ªânh, li√™n k·∫øt v·ªõi email, vi·ªác n√†y kh√° d·ªÖ d√†ng.

## C√¢u h·ªèi ph·ªèng v·∫•n

D∆∞·ªõi ƒë√¢y l√† c√°c c√¢u h·ªèi ph·ªèng v·∫•n ph·ªï bi·∫øn m√† nh√† tuy·ªÉn d·ª•ng c√≥ th·ªÉ h·ªèi li√™n quan ƒë·∫øn Skywalking v√† d·ª± √°n PmHub.

**Q:** H√£y gi·∫£i th√≠ch Skywalking l√† g√¨? N√≥ ƒë√≥ng vai tr√≤ g√¨ trong gi√°m s√°t hi·ªáu nƒÉng v√† theo d√µi ph√¢n t√°n?

**A:** Skywalking l√† m·ªôt h·ªá th·ªëng m√£ ngu·ªìn m·ªü APM (Application Performance Monitoring) v√† theo d√µi ph√¢n t√°n. N√≥ gi√∫p ch√∫ng ta gi√°m s√°t hi·ªáu nƒÉng c·ªßa h·ªá th·ªëng ph√¢n t√°n, theo d√µi to√†n b·ªô chu·ªói request, x√°c ƒë·ªãnh c√°c ƒëi·ªÉm ngh·∫Ωn hi·ªáu nƒÉng v√† ƒëi·ªÉm l·ªói.

**Q:** Khi ch·ªçn Skywalking l√†m c√¥ng c·ª• gi√°m s√°t hi·ªáu nƒÉng, b·∫°n ƒë√£ xem x√©t nh·ªØng c√¥ng c·ª• n√†o kh√°c v√† t·∫°i sao l·∫°i ch·ªçn Skywalking?

**A:** Ch√∫ng t√¥i ƒë√£ xem x√©t Zipkin v√† Jaeger. Ch√∫ng t√¥i ch·ªçn Skywalking v√¨ n√≥ t√≠ch h·ª£p c·∫£ gi√°m s√°t hi·ªáu nƒÉng v√† theo d√µi ph√¢n t√°n, h·ªó tr·ª£ nhi·ªÅu ng√¥n ng·ªØ v√† √≠t x√¢m ph·∫°m v√†o m√£ ngu·ªìn, ph√π h·ª£p v·ªõi d·ª± √°n c·ªßa ch√∫ng t√¥i.

**Q:** B·∫°n ƒë√£ t√≠ch h·ª£p Skywalking ƒë·ªÉ gi√°m s√°t hi·ªáu nƒÉng c·ªßa PmHub nh∆∞ th·∫ø n√†o? H√£y m√¥ t·∫£ qu√° tr√¨nh th·ª±c hi·ªán.

**A:** Ch√∫ng t√¥i ƒë√£ t√≠ch h·ª£p agent c·ªßa Skywalking v√†o PmHub, s·ª≠ d·ª•ng Skywalking OAP ƒë·ªÉ thu th·∫≠p v√† l∆∞u tr·ªØ d·ªØ li·ªáu. C√°c ch·ªâ s·ªë nh∆∞ th·ªùi gian ph·∫£n h·ªìi, l∆∞u l∆∞·ª£ng v√† t·ª∑ l·ªá l·ªói ƒë∆∞·ª£c c·∫•u h√¨nh ƒë·ªÉ theo d√µi hi·ªáu nƒÉng h·ªá th·ªëng.

**Q:** Nh·ªØng ch·ªâ s·ªë gi√°m s√°t n√†o b·∫°n s·ª≠ d·ª•ng ƒë·ªÉ ƒë√°nh gi√° hi·ªáu nƒÉng c·ªßa PmHub?

**A:** Ch√∫ng t√¥i theo d√µi th·ªùi gian ph·∫£n h·ªìi, l∆∞u l∆∞·ª£ng, t·ª∑ l·ªá l·ªói, chu·ªói g·ªçi v√† th·ªùi gian truy v·∫•n c∆° s·ªü d·ªØ li·ªáu ƒë·ªÉ hi·ªÉu r√µ t√¨nh tr·∫°ng v√† c√°c ƒëi·ªÉm ngh·∫Ωn hi·ªáu nƒÉng.

**Q:** Skywalking ƒë√£ gi√∫p b·∫°n ph√¢n t√≠ch v√† gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ hi·ªáu nƒÉng nh∆∞ th·∫ø n√†o trong theo d√µi ph√¢n t√°n?

**A:** Skywalking gi√∫p theo d√µi to√†n b·ªô chu·ªói g·ªçi c·ªßa t·ª´ng y√™u c·∫ßu, t·ª´ ƒë√≥ x√°c ƒë·ªãnh ƒëi·ªÉm ngh·∫Ωn hi·ªáu nƒÉng v√† l·ªói. Qua ph√¢n t√≠ch chu·ªói g·ªçi, ch√∫ng t√¥i c√≥ th·ªÉ t√¨m ra v·∫•n ƒë·ªÅ ·ªü microservice n√†o v√† x·ª≠ l√Ω nhanh ch√≥ng.

**Q:** B·∫°n c√≥ th·ªÉ k·ªÉ m·ªôt v√≠ d·ª• v·ªÅ vi·ªác ph√°t hi·ªán v√† gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ hi·ªáu nƒÉng th√¥ng qua theo d√µi ph√¢n t√°n kh√¥ng?

**A:** Ch√∫ng t√¥i ph√°t hi·ªán m·ªôt y√™u c·∫ßu c√≥ th·ªùi gian ph·∫£n h·ªìi d√†i b·∫•t th∆∞·ªùng. Qua ph√¢n t√≠ch chu·ªói g·ªçi, ch√∫ng t√¥i nh·∫≠n th·∫•y v·∫•n ƒë·ªÅ n·∫±m ·ªü truy v·∫•n c∆° s·ªü d·ªØ li·ªáu thi·∫øu ch·ªâ m·ª•c. Sau khi t·ªëi ∆∞u ch·ªâ m·ª•c, hi·ªáu nƒÉng truy v·∫•n ƒë∆∞·ª£c c·∫£i thi·ªán ƒë√°ng k·ªÉ.

C√¢u h·ªèi v√† c√¢u tr·∫£ l·ªùi n√†y gi√∫p ƒë√°nh gi√° kinh nghi·ªám th·ª±c t·∫ø c·ªßa ·ª©ng vi√™n v·ªÅ t√≠ch h·ª£p Skywalking, gi√°m s√°t hi·ªáu nƒÉng, theo d√µi ph√¢n t√°n v√† t·ªëi ∆∞u h√≥a h·ªá th·ªëng.